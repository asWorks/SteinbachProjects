/*
Deployment script for ProjektDB_Steinbach_Kunde

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "ProjektDB_Steinbach_Kunde"
:setvar DefaultFilePrefix "ProjektDB_Steinbach_Kunde"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Dropping DF_SI_Belege_created...';


GO
ALTER TABLE [dbo].[SI_Belege] DROP CONSTRAINT [DF_SI_Belege_created];


GO
PRINT N'Dropping FK_SchiffAnlage_Schiff...';


GO
ALTER TABLE [dbo].[SchiffAnlage] DROP CONSTRAINT [FK_SchiffAnlage_Schiff];


GO
PRINT N'Dropping FK_SI_BelegeTextbausteine_SI_BelegeTextbausteine...';


GO
ALTER TABLE [dbo].[SI_BelegeTextbausteine] DROP CONSTRAINT [FK_SI_BelegeTextbausteine_SI_BelegeTextbausteine];


GO
PRINT N'Dropping FK_SI_BelegePositionen_SI_Belege...';


GO
ALTER TABLE [dbo].[SI_BelegePositionen] DROP CONSTRAINT [FK_SI_BelegePositionen_SI_Belege];


GO
PRINT N'Dropping FK_SI_BelegeZusatzzeilen_SI_Belege...';


GO
ALTER TABLE [dbo].[SI_BelegeZusatzzeilen] DROP CONSTRAINT [FK_SI_BelegeZusatzzeilen_SI_Belege];


GO
PRINT N'Dropping FK_SI_Belege_person...';


GO
ALTER TABLE [dbo].[SI_Belege] DROP CONSTRAINT [FK_SI_Belege_person];


GO
PRINT N'Dropping FK_SI_Belege_StammLagerorteQuellLager...';


GO
ALTER TABLE [dbo].[SI_Belege] DROP CONSTRAINT [FK_SI_Belege_StammLagerorteQuellLager];


GO
PRINT N'Dropping FK_SI_Belege_StammLagerorteZiellager...';


GO
ALTER TABLE [dbo].[SI_Belege] DROP CONSTRAINT [FK_SI_Belege_StammLagerorteZiellager];


GO
PRINT N'Dropping FK_SI_Belege_StammBelegarten...';


GO
ALTER TABLE [dbo].[SI_Belege] DROP CONSTRAINT [FK_SI_Belege_StammBelegarten];


GO
PRINT N'Dropping FK_SI_Rechnungsausgang_SI_Belege...';


GO
ALTER TABLE [dbo].[SI_Rechnungsausgang] DROP CONSTRAINT [FK_SI_Rechnungsausgang_SI_Belege];


GO
PRINT N'Dropping FK_SI_BelegartenTextbausteine_SI_Textbausteine...';


GO
ALTER TABLE [dbo].[SI_BelegartenTextbausteine] DROP CONSTRAINT [FK_SI_BelegartenTextbausteine_SI_Textbausteine];


GO
PRINT N'Altering [dbo].[projekt]...';


GO
ALTER TABLE [dbo].[projekt]
    ADD [istUmsatzsteuerbefreit] SMALLINT NULL,
        [id_Sprache]             INT      NULL;


GO
PRINT N'Starting rebuilding table [dbo].[schiff]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_schiff] (
    [id]                 INT            IDENTITY (1, 1) NOT NULL,
    [created]            DATETIME       NULL,
    [owner]              NVARCHAR (255) NULL,
    [name]               NVARCHAR (255) NULL,
    [imonummer]          INT            NULL,
    [brplantnr]          NVARCHAR (16)  NULL,
    [brplantnr2]         NVARCHAR (16)  NULL,
    [brplantnr3]         NVARCHAR (16)  NULL,
    [brplantnr4]         NVARCHAR (16)  NULL,
    [jtunitnr]           NVARCHAR (32)  NULL,
    [jtursprungsprojekt] NVARCHAR (120) NULL,
    [spnr]               NVARCHAR (32)  NULL,
    [spursprungsprojekt] NVARCHAR (120) NULL,
    [brpprojektnr]       NVARCHAR (120) NULL,
    [brursprungsprojekt] NVARCHAR (120) NULL,
    [taursprungsprojekt] NVARCHAR (120) NULL,
    [nyursprungsprojekt] NVARCHAR (120) NULL,
    [foursprungsprojekt] NVARCHAR (120) NULL,
    [teursprungsprojekt] NVARCHAR (120) NULL,
    [mmursprungsprojekt] NVARCHAR (120) NULL,
    [mzursprungsprojekt] NVARCHAR (120) NULL,
    [werftname]          NVARCHAR (64)  NULL,
    [werftnummer]        NVARCHAR (32)  NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_schiff] PRIMARY KEY CLUSTERED ([id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[schiff])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_schiff] ON;
        INSERT INTO [dbo].[tmp_ms_xx_schiff] ([id], [created], [owner], [name], [imonummer], [brplantnr], [brplantnr2], [brplantnr3], [brplantnr4], [jtunitnr], [jtursprungsprojekt], [spnr], [spursprungsprojekt], [brpprojektnr], [brursprungsprojekt], [taursprungsprojekt], [nyursprungsprojekt], [foursprungsprojekt], [teursprungsprojekt], [werftname], [werftnummer])
        SELECT   [id],
                 [created],
                 [owner],
                 [name],
                 [imonummer],
                 [brplantnr],
                 [brplantnr2],
                 [brplantnr3],
                 [brplantnr4],
                 [jtunitnr],
                 [jtursprungsprojekt],
                 [spnr],
                 [spursprungsprojekt],
                 [brpprojektnr],
                 [brursprungsprojekt],
                 [taursprungsprojekt],
                 [nyursprungsprojekt],
                 [foursprungsprojekt],
                 [teursprungsprojekt],
                 [werftname],
                 [werftnummer]
        FROM     [dbo].[schiff]
        ORDER BY [id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_schiff] OFF;
    END

DROP TABLE [dbo].[schiff];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_schiff]', N'schiff';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_schiff]', N'PK_schiff', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[schiff].[IX_name]...';


GO
CREATE NONCLUSTERED INDEX [IX_name]
    ON [dbo].[schiff]([id] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[SI_Belege]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_SI_Belege] (
    [id]                    INT            IDENTITY (1, 1) NOT NULL,
    [created]               DATETIME       CONSTRAINT [DF_SI_Belege_created] DEFAULT (getdate()) NULL,
    [Belegart]              NVARCHAR (10)  NULL,
    [Belegnummer]           NCHAR (20)     NULL,
    [Belegdatum]            DATETIME       NULL,
    [id_Ziellager]          INT            NULL,
    [id_Quelllager]         INT            NULL,
    [id_Projekt]            INT            NULL,
    [Projektnummer]         NVARCHAR (20)  NULL,
    [Quellbeleg]            INT            NULL,
    [id_Quellbeleg]         INT            NULL,
    [id_Vorgang]            INT            NULL,
    [istInitialBeleg]       SMALLINT       NULL,
    [istGebucht]            SMALLINT       NULL,
    [Bemerkung]             NVARCHAR (MAX) NULL,
    [id_Sprache]            INT            NULL,
    [id_Firma]              INT            NULL,
    [id_Adresse]            INT            NULL,
    [Ort]                   NVARCHAR (150) NULL,
    [PLZ]                   NVARCHAR (50)  NULL,
    [ZusatzInfo]            NVARCHAR (255) NULL,
    [ZusatzInfo2]           NVARCHAR (255) NULL,
    [ZusatzInfo3]           NVARCHAR (255) NULL,
    [Land]                  NVARCHAR (150) NULL,
    [Straﬂe]                NVARCHAR (255) NULL,
    [VAT]                   NVARCHAR (50)  NULL,
    [BelegnummerLieferant]  NVARCHAR (50)  NULL,
    [id_user]               INT            NULL,
    [Belegtext]             NVARCHAR (MAX) NULL,
    [SummeBelegPositionen]  MONEY          NULL,
    [IstUmsatzsteuer]       SMALLINT       NULL,
    [Umsatzsteuersatz]      MONEY          NULL,
    [Belegsumme]            MONEY          NULL,
    [BelegsummeFix]         MONEY          NULL,
    [Signatur1]             NVARCHAR (255) NULL,
    [Signatur2]             NVARCHAR (255) NULL,
    [ZahlungsbedingungText] NVARCHAR (255) NULL,
    [id_Zahlungsbedingung]  INT            NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_SI_Belege] PRIMARY KEY CLUSTERED ([id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[SI_Belege])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_SI_Belege] ON;
        INSERT INTO [dbo].[tmp_ms_xx_SI_Belege] ([id], [created], [Belegart], [Belegnummer], [Belegdatum], [id_Ziellager], [id_Quelllager], [id_Projekt], [Projektnummer], [QuellBeleg], [istGebucht], [Bemerkung], [id_Sprache], [id_Firma], [id_Adresse], [Ort], [PLZ], [ZusatzInfo], [ZusatzInfo2], [ZusatzInfo3], [Land], [Straﬂe], [VAT], [BelegnummerLieferant], [id_user], [Belegtext], [SummeBelegPositionen], [IstUmsatzsteuer], [Umsatzsteuersatz], [Belegsumme], [BelegsummeFix], [Signatur1], [Signatur2])
        SELECT   [id],
                 [created],
                 [Belegart],
                 [Belegnummer],
                 [Belegdatum],
                 [id_Ziellager],
                 [id_Quelllager],
                 [id_Projekt],
                 [Projektnummer],
                 [QuellBeleg],
                 [istGebucht],
                 [Bemerkung],
                 [id_Sprache],
                 [id_Firma],
                 [id_Adresse],
                 [Ort],
                 [PLZ],
                 [ZusatzInfo],
                 [ZusatzInfo2],
                 [ZusatzInfo3],
                 [Land],
                 [Straﬂe],
                 [VAT],
                 [BelegnummerLieferant],
                 [id_user],
                 [Belegtext],
                 [SummeBelegPositionen],
                 [IstUmsatzsteuer],
                 [Umsatzsteuersatz],
                 [Belegsumme],
                 [BelegsummeFix],
                 [Signatur1],
                 [Signatur2]
        FROM     [dbo].[SI_Belege]
        ORDER BY [id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_SI_Belege] OFF;
    END

DROP TABLE [dbo].[SI_Belege];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_SI_Belege]', N'SI_Belege';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_SI_Belege]', N'PK_SI_Belege', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Altering [dbo].[StammBelegarten]...';


GO
ALTER TABLE [dbo].[StammBelegarten]
    ADD [CalculateColumn]           NVARCHAR (20) NULL,
        [Wirkung]                   INT           NULL,
        [ZahlungsbedingungenSetzen] SMALLINT      NULL;


GO
PRINT N'Creating [dbo].[SI_BelegartenBelegUebenahme]...';


GO
CREATE TABLE [dbo].[SI_BelegartenBelegUebenahme] (
    [id]                INT           IDENTITY (1, 1) NOT NULL,
    [id_BelegArt]       NVARCHAR (10) NULL,
    [UebernahmeBelgart] NVARCHAR (10) NULL,
    [ColumnName]        NVARCHAR (50) NULL,
    CONSTRAINT [PK_BelegartenBelegUebenahme] PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[SI_Vorgaenge]...';


GO
CREATE TABLE [dbo].[SI_Vorgaenge] (
    [id]           INT           IDENTITY (1, 1) NOT NULL,
    [Datum]        DATETIME      NULL,
    [id_Kunde]     INT           NULL,
    [id_Projekt]   INT           NULL,
    [Vorgang]      NVARCHAR (50) NULL,
    [AnzahlBelege] INT           NULL,
    [letzterBeleg] DATETIME      NULL,
    CONSTRAINT [PK_SI_Vorgaenge] PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[SI_VorgaengePositionen]...';


GO
CREATE TABLE [dbo].[SI_VorgaengePositionen] (
    [id]           INT      IDENTITY (1, 1) NOT NULL,
    [id_Vorgang]   INT      NULL,
    [id_Artikel]   INT      NULL,
    [MengeAB]      MONEY    NULL,
    [MengeLS]      MONEY    NULL,
    [MengeRLS]     MONEY    NULL,
    [MengeGS]      MONEY    NULL,
    [MengeRg]      MONEY    NULL,
    [istGeliefert] SMALLINT NULL,
    [istBerechnet] SMALLINT NULL,
    CONSTRAINT [PK_SI_VorgaengePositionen] PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[SI_Zahlungsbedingungen_Sprachen]...';


GO
CREATE TABLE [dbo].[SI_Zahlungsbedingungen_Sprachen] (
    [id]                   INT            IDENTITY (1, 1) NOT NULL,
    [id_Sprache]           INT            NOT NULL,
    [id_Zahlungsbedingung] INT            NOT NULL,
    [Text]                 NVARCHAR (250) NULL,
    CONSTRAINT [PK_SI_Zahlungsbedingungen_Sprachen] PRIMARY KEY CLUSTERED ([id_Sprache] ASC, [id_Zahlungsbedingung] ASC)
);


GO
PRINT N'Creating FK_SchiffAnlage_Schiff...';


GO
ALTER TABLE [dbo].[SchiffAnlage] WITH NOCHECK
    ADD CONSTRAINT [FK_SchiffAnlage_Schiff] FOREIGN KEY ([id_Schiff]) REFERENCES [dbo].[schiff] ([id]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating FK_SI_BelegeTextbausteine_SI_BelegeTextbausteine...';


GO
ALTER TABLE [dbo].[SI_BelegeTextbausteine] WITH NOCHECK
    ADD CONSTRAINT [FK_SI_BelegeTextbausteine_SI_BelegeTextbausteine] FOREIGN KEY ([id_Beleg]) REFERENCES [dbo].[SI_Belege] ([id]);


GO
PRINT N'Creating FK_SI_BelegePositionen_SI_Belege...';


GO
ALTER TABLE [dbo].[SI_BelegePositionen] WITH NOCHECK
    ADD CONSTRAINT [FK_SI_BelegePositionen_SI_Belege] FOREIGN KEY ([id_Beleg]) REFERENCES [dbo].[SI_Belege] ([id]);


GO
PRINT N'Creating FK_SI_BelegeZusatzzeilen_SI_Belege...';


GO
ALTER TABLE [dbo].[SI_BelegeZusatzzeilen] WITH NOCHECK
    ADD CONSTRAINT [FK_SI_BelegeZusatzzeilen_SI_Belege] FOREIGN KEY ([id_Beleg]) REFERENCES [dbo].[SI_Belege] ([id]);


GO
PRINT N'Creating FK_SI_Belege_person...';


GO
ALTER TABLE [dbo].[SI_Belege] WITH NOCHECK
    ADD CONSTRAINT [FK_SI_Belege_person] FOREIGN KEY ([id_user]) REFERENCES [dbo].[person] ([id]);


GO
PRINT N'Creating FK_SI_Belege_StammLagerorteQuellLager...';


GO
ALTER TABLE [dbo].[SI_Belege] WITH NOCHECK
    ADD CONSTRAINT [FK_SI_Belege_StammLagerorteQuellLager] FOREIGN KEY ([id_Quelllager]) REFERENCES [dbo].[StammLagerorte] ([id]);


GO
PRINT N'Creating FK_SI_Belege_StammLagerorteZiellager...';


GO
ALTER TABLE [dbo].[SI_Belege] WITH NOCHECK
    ADD CONSTRAINT [FK_SI_Belege_StammLagerorteZiellager] FOREIGN KEY ([id_Ziellager]) REFERENCES [dbo].[StammLagerorte] ([id]);


GO
PRINT N'Creating FK_SI_Belege_StammBelegarten...';


GO
ALTER TABLE [dbo].[SI_Belege] WITH NOCHECK
    ADD CONSTRAINT [FK_SI_Belege_StammBelegarten] FOREIGN KEY ([Belegart]) REFERENCES [dbo].[StammBelegarten] ([id]);


GO
PRINT N'Creating FK_SI_Rechnungsausgang_SI_Belege...';


GO
ALTER TABLE [dbo].[SI_Rechnungsausgang] WITH NOCHECK
    ADD CONSTRAINT [FK_SI_Rechnungsausgang_SI_Belege] FOREIGN KEY ([id_Beleg]) REFERENCES [dbo].[SI_Belege] ([id]);


GO
PRINT N'Creating FK_SI_Belege_SI_Vorgaenge...';


GO
ALTER TABLE [dbo].[SI_Belege] WITH NOCHECK
    ADD CONSTRAINT [FK_SI_Belege_SI_Vorgaenge] FOREIGN KEY ([id_Vorgang]) REFERENCES [dbo].[SI_Vorgaenge] ([id]);


GO
PRINT N'Creating FK_SI_Belege_SIQuellbeleg...';


GO
ALTER TABLE [dbo].[SI_Belege] WITH NOCHECK
    ADD CONSTRAINT [FK_SI_Belege_SIQuellbeleg] FOREIGN KEY ([id_Quellbeleg]) REFERENCES [dbo].[SI_Belege] ([id]);


GO
PRINT N'Creating FK_BelegartenBelegUebenahme_StammBelegarten...';


GO
ALTER TABLE [dbo].[SI_BelegartenBelegUebenahme] WITH NOCHECK
    ADD CONSTRAINT [FK_BelegartenBelegUebenahme_StammBelegarten] FOREIGN KEY ([id_BelegArt]) REFERENCES [dbo].[StammBelegarten] ([id]);


GO
PRINT N'Creating FK_BelegartenBelegUebenahme_StammBelegarten1...';


GO
ALTER TABLE [dbo].[SI_BelegartenBelegUebenahme] WITH NOCHECK
    ADD CONSTRAINT [FK_BelegartenBelegUebenahme_StammBelegarten1] FOREIGN KEY ([UebernahmeBelgart]) REFERENCES [dbo].[StammBelegarten] ([id]);


GO
PRINT N'Creating FK_SI_Vorgaenge_firma...';


GO
ALTER TABLE [dbo].[SI_Vorgaenge] WITH NOCHECK
    ADD CONSTRAINT [FK_SI_Vorgaenge_firma] FOREIGN KEY ([id_Kunde]) REFERENCES [dbo].[firma] ([id]);


GO
PRINT N'Creating FK_SI_Vorgaenge_projekt...';


GO
ALTER TABLE [dbo].[SI_Vorgaenge] WITH NOCHECK
    ADD CONSTRAINT [FK_SI_Vorgaenge_projekt] FOREIGN KEY ([id_Projekt]) REFERENCES [dbo].[projekt] ([id]);


GO
PRINT N'Creating FK_SI_VorgaengePositionen_SI_Vorgaenge...';


GO
ALTER TABLE [dbo].[SI_VorgaengePositionen] WITH NOCHECK
    ADD CONSTRAINT [FK_SI_VorgaengePositionen_SI_Vorgaenge] FOREIGN KEY ([id_Vorgang]) REFERENCES [dbo].[SI_Vorgaenge] ([id]);


GO
PRINT N'Creating FK_SI_VorgaengePositionen_lagerliste...';


GO
ALTER TABLE [dbo].[SI_VorgaengePositionen] WITH NOCHECK
    ADD CONSTRAINT [FK_SI_VorgaengePositionen_lagerliste] FOREIGN KEY ([id_Artikel]) REFERENCES [dbo].[lagerliste] ([id]);


GO
PRINT N'Creating FK_SI_Zahlungsbedingungen_Sprachen_StammZahlungsbedingungen...';


GO
ALTER TABLE [dbo].[SI_Zahlungsbedingungen_Sprachen] WITH NOCHECK
    ADD CONSTRAINT [FK_SI_Zahlungsbedingungen_Sprachen_StammZahlungsbedingungen] FOREIGN KEY ([id_Zahlungsbedingung]) REFERENCES [dbo].[StammZahlungsbedingungen] ([id]);


GO
PRINT N'Refreshing [dbo].[ausgangsrechnungen]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[ausgangsrechnungen]';


GO
PRINT N'Refreshing [dbo].[Temp_SI_Belege]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[Temp_SI_Belege]';


GO
PRINT N'Refreshing [dbo].[vw_Lagerlisten_AddRemove]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[vw_Lagerlisten_AddRemove]';


GO
PRINT N'Refreshing [dbo].[vw_Projekte_si_rgKunde]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[vw_Projekte_si_rgKunde]';


GO
PRINT N'Refreshing [dbo].[vwBrunvollAuftragsbestand]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[vwBrunvollAuftragsbestand]';


GO
PRINT N'Refreshing [dbo].[vwFirmenKontakteProjekte]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[vwFirmenKontakteProjekte]';


GO
PRINT N'Refreshing [dbo].[vwProjekt_ProjektRechnungen]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[vwProjekt_ProjektRechnungen]';


GO
PRINT N'Refreshing [dbo].[vwProjektAnlagentyp]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[vwProjektAnlagentyp]';


GO
PRINT N'Refreshing [dbo].[vwProjektDeckblaetter]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[vwProjektDeckblaetter]';


GO
PRINT N'Refreshing [dbo].[vwProjektMitVerlauf]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[vwProjektMitVerlauf]';


GO
PRINT N'Refreshing [dbo].[View1]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[View1]';


GO
PRINT N'Creating [dbo].[view_BelegartenBelegUebernahme]...';


GO
CREATE VIEW dbo.view_BelegartenBelegUebernahme
AS
SELECT        dbo.SI_BelegartenBelegUebenahme.id AS id_BelegartenBeleguebernahme, dbo.StammBelegarten.id AS id_StammBelegarten, dbo.SI_BelegartenBelegUebenahme.id_BelegArt, 
                         dbo.SI_BelegartenBelegUebenahme.UebernahmeBelgart, dbo.StammBelegarten.Belegart
FROM            dbo.SI_BelegartenBelegUebenahme INNER JOIN
                         dbo.StammBelegarten ON dbo.SI_BelegartenBelegUebenahme.UebernahmeBelgart = dbo.StammBelegarten.id
GO
PRINT N'Creating [dbo].[View_Belege_BelegePositionen]...';


GO
CREATE VIEW dbo.View_Belege_BelegePositionen
AS
SELECT        dbo.SI_Belege.id_Vorgang, dbo.SI_Belege.Belegnummer, dbo.SI_Belege.Belegdatum, dbo.SI_Belege.Belegart, dbo.SI_BelegePositionen.Artikelnummer, dbo.SI_BelegePositionen.Menge, 
                         dbo.SI_BelegePositionen.Preis, dbo.SI_BelegePositionen.Endpreis, dbo.SI_BelegePositionen.id_Artikel, dbo.SI_Belege.id AS id_SI_Belege, dbo.SI_BelegePositionen.id AS id_SI_BelegePositionen
FROM            dbo.SI_Belege INNER JOIN
                         dbo.SI_BelegePositionen ON dbo.SI_Belege.id = dbo.SI_BelegePositionen.id_Beleg
GO
PRINT N'Creating [dbo].[view_BelegartenBelegUebernahme].[MS_DiagramPane1]...';


GO
EXECUTE sp_addextendedproperty @name = N'MS_DiagramPane1', @value = N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[41] 4[20] 2[10] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1 [50] 4 [25] 3))"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1 [50] 2 [25] 3))"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1 [56] 3))"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2 [66] 3))"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3))"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1 [75] 4))"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 0
   End
   Begin DiagramPane = 
      Begin Origin = 
         Top = 0
         Left = 0
      End
      Begin Tables = 
         Begin Table = "SI_BelegartenBelegUebenahme"
            Begin Extent = 
               Top = 6
               Left = 38
               Bottom = 319
               Right = 345
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "StammBelegarten"
            Begin Extent = 
               Top = 8
               Left = 422
               Bottom = 323
               Right = 634
            End
            DisplayFlags = 280
            TopColumn = 0
         End
      End
   End
   Begin SQLPane = 
   End
   Begin DataPane = 
      Begin ParameterDefaults = ""
      End
      Begin ColumnWidths = 9
         Width = 284
         Width = 2925
         Width = 2160
         Width = 1500
         Width = 2265
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
      End
   End
   Begin CriteriaPane = 
      Begin ColumnWidths = 11
         Column = 1980
         Alias = 2865
         Table = 1170
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End
', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'VIEW', @level1name = N'view_BelegartenBelegUebernahme';


GO
PRINT N'Creating [dbo].[view_BelegartenBelegUebernahme].[MS_DiagramPaneCount]...';


GO
EXECUTE sp_addextendedproperty @name = N'MS_DiagramPaneCount', @value = 1, @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'VIEW', @level1name = N'view_BelegartenBelegUebernahme';


GO
PRINT N'Creating [dbo].[View_Belege_BelegePositionen].[MS_DiagramPane1]...';


GO
EXECUTE sp_addextendedproperty @name = N'MS_DiagramPane1', @value = N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[38] 4[10] 2[3] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1 [50] 4 [25] 3))"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1 [50] 2 [25] 3))"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1 [56] 3))"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2 [66] 3))"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3))"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1 [75] 4))"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 0
   End
   Begin DiagramPane = 
      Begin Origin = 
         Top = 0
         Left = 0
      End
      Begin Tables = 
         Begin Table = "SI_Belege"
            Begin Extent = 
               Top = 6
               Left = 38
               Bottom = 297
               Right = 253
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "SI_BelegePositionen"
            Begin Extent = 
               Top = 6
               Left = 291
               Bottom = 308
               Right = 480
            End
            DisplayFlags = 280
            TopColumn = 0
         End
      End
   End
   Begin SQLPane = 
   End
   Begin DataPane = 
      Begin ParameterDefaults = ""
      End
      Begin ColumnWidths = 12
         Width = 284
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
      End
   End
   Begin CriteriaPane = 
      Begin ColumnWidths = 11
         Column = 1440
         Alias = 2190
         Table = 1170
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End
', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'VIEW', @level1name = N'View_Belege_BelegePositionen';


GO
PRINT N'Creating [dbo].[View_Belege_BelegePositionen].[MS_DiagramPaneCount]...';


GO
EXECUTE sp_addextendedproperty @name = N'MS_DiagramPaneCount', @value = 1, @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'VIEW', @level1name = N'View_Belege_BelegePositionen';


GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [dbo].[SchiffAnlage] WITH CHECK CHECK CONSTRAINT [FK_SchiffAnlage_Schiff];

ALTER TABLE [dbo].[SI_BelegeTextbausteine] WITH CHECK CHECK CONSTRAINT [FK_SI_BelegeTextbausteine_SI_BelegeTextbausteine];

ALTER TABLE [dbo].[SI_BelegePositionen] WITH CHECK CHECK CONSTRAINT [FK_SI_BelegePositionen_SI_Belege];

ALTER TABLE [dbo].[SI_BelegeZusatzzeilen] WITH CHECK CHECK CONSTRAINT [FK_SI_BelegeZusatzzeilen_SI_Belege];

ALTER TABLE [dbo].[SI_Belege] WITH CHECK CHECK CONSTRAINT [FK_SI_Belege_person];

ALTER TABLE [dbo].[SI_Belege] WITH CHECK CHECK CONSTRAINT [FK_SI_Belege_StammLagerorteQuellLager];

ALTER TABLE [dbo].[SI_Belege] WITH CHECK CHECK CONSTRAINT [FK_SI_Belege_StammLagerorteZiellager];

ALTER TABLE [dbo].[SI_Belege] WITH CHECK CHECK CONSTRAINT [FK_SI_Belege_StammBelegarten];

ALTER TABLE [dbo].[SI_Rechnungsausgang] WITH CHECK CHECK CONSTRAINT [FK_SI_Rechnungsausgang_SI_Belege];

ALTER TABLE [dbo].[SI_Belege] WITH CHECK CHECK CONSTRAINT [FK_SI_Belege_SI_Vorgaenge];

ALTER TABLE [dbo].[SI_Belege] WITH CHECK CHECK CONSTRAINT [FK_SI_Belege_SIQuellbeleg];

ALTER TABLE [dbo].[SI_BelegartenBelegUebenahme] WITH CHECK CHECK CONSTRAINT [FK_BelegartenBelegUebenahme_StammBelegarten];

ALTER TABLE [dbo].[SI_BelegartenBelegUebenahme] WITH CHECK CHECK CONSTRAINT [FK_BelegartenBelegUebenahme_StammBelegarten1];

ALTER TABLE [dbo].[SI_Vorgaenge] WITH CHECK CHECK CONSTRAINT [FK_SI_Vorgaenge_firma];

ALTER TABLE [dbo].[SI_Vorgaenge] WITH CHECK CHECK CONSTRAINT [FK_SI_Vorgaenge_projekt];

ALTER TABLE [dbo].[SI_VorgaengePositionen] WITH CHECK CHECK CONSTRAINT [FK_SI_VorgaengePositionen_SI_Vorgaenge];

ALTER TABLE [dbo].[SI_VorgaengePositionen] WITH CHECK CHECK CONSTRAINT [FK_SI_VorgaengePositionen_lagerliste];

ALTER TABLE [dbo].[SI_Zahlungsbedingungen_Sprachen] WITH CHECK CHECK CONSTRAINT [FK_SI_Zahlungsbedingungen_Sprachen_StammZahlungsbedingungen];


GO
PRINT N'Update complete.';


GO
